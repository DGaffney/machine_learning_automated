<div class="row">
    <div class="col-sm-12">
      <h1><%= current_user.first_name %>'s datasets</h1>
    </div>
</div>
<br />
<div class="row">
  <div class="col-sm-12">
    <form action="/preview" method="POST" enctype="multipart/form-data">
      <div class="row">
        <div class="col-sm-3">
          <h4>Add a New Dataset:</h4>
        </div>
        <div class="col-sm-6">
          <div class="input-group">
            <input type="file" name="file" class="file">
            <span class="input-group-addon"><i class="fa fa-database" aria-hidden="true"></i></span>
            <input type="text" class="form-control input-lg" disabled="" placeholder="Select Dataset">
            <span class="input-group-btn">
              <button class="browse btn btn-primary input-lg" type="button"><i class="glyphicon glyphicon-search"></i> Browse</button>
            </span>
          </div>
        </div>
        <div class="col-sm-3">
        <button type="submit" class="btn btn-primary">Upload CSV</button>
      </div>
      </div>
    </form>
    <script>
      $(document).on('click', '.browse', function(){
        var file = $(this).parent().parent().find('.file');
        console.log($(this).parent().parent().children())
        file.trigger('click');
      });
      $(document).on('change', '.file', function(){
        $(this).parent().find('.form-control').val($(this).val().replace(/C:\\fakepath\\/i, ''));
      });
    </script>
  </div>
</div>

<div class="row">
  <div class="col-sm-12">
    <% if @datasets.empty? %>
      <p>You currently don't have any datasets uploaded. In order to get started, add one to the right</p>
    <% else %>
      <table class="table">
        <thead>
          <tr>
            <th>#</th>
            <th>Filename</th>
            <th><a href="#" data-toggle="tooltip" title="Users are allotted a total of 200mb of compressed data on the server.">Filesize (<%= current_user.file_usage %>% used)</a></th>
            <th>Row Count</th>
            <th>Feature Count</th>
            <th>Status</th>
            <th>Last Updated</th>
          </tr>
        </thead>
        <tbody>
          <% @datasets.each do |dataset| %>
            <tr>
              <th scope="row">1</th>
              <td><a href="/datasets/<%= current_user_id %>/<%= dataset.id %>"><%= dataset.filename %></a></td>
              <td><%= dataset.filesize_mb.round(2) %> MB</td>
              <td><%= dataset.row_count %></td>
              <td><%= dataset.feature_count %></td>
              <td><%= dataset.get_current_status %></td>
              <td><%= TimeDifference.between(dataset.get_updated_at, Time.now).humanize %></td>
            </tr>
            <br />
          <% end %>
        </tbody>
      </table>
    <% end %>
  </div>
</div>
<script>
  $(function () {
    $('[data-toggle="tooltip"]').tooltip()
  })
</script>
  

